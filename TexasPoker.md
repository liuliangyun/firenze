# 德州扑克游戏规则

## 使用道具
一副标准扑克牌去掉大小王后的52张牌进行游戏。

## 游戏人数
2-10个玩家。

## 游戏目的
赢取其他玩家的筹码。

## 游戏玩家
+ 庄家：每局游戏都会有一名庄家，当一局牌局结束后，庄家按照顺时针方向下移一位。
+ 小盲注玩家：庄家左手边为小盲注玩家，在牌局开始之前，需要投下小盲注。
+ 大盲注玩家：小盲注左手边为大盲注玩家，在牌局开始之前，需要投下大盲注，一般而言，大盲注是小盲注的2倍。
+ 普通玩家：除庄家、小盲注玩家、大盲注玩家以外的其他玩家。

注：当只有两个玩家时，大盲注玩家也是庄家

## 玩家操作（表态）
+ 跟注：玩家下注，且金额跟场上的最高投注额相同。
+ 加注：玩家下注，且金额超过场上的最高投注额。
+ 过牌：玩家暂不表态，由下一个玩家进行表态。
+ 弃牌：放弃游戏。
+ All in：玩家将所持有的筹码全部下注。（默认All in为玩家所持筹码数小于当前最高投注金额，如果等于将视为跟注，如果大于将视为加注）

## 游戏轮数
确定好小盲注和大盲注后，游戏开始，游戏一共分为4轮：
+ 第一轮，给每个玩家发两张底牌，从大盲注后的第一个人玩家开始，剩余玩家按照顺时针方向依次表态，玩家可以选择跟注、加注、弃牌、All in。
+ 第二轮，翻出3张公共牌，由小盲注开始（如果小盲注已弃牌，由后面最近的玩家开始，以此类推），剩余玩家按照顺时针方向依次表态，玩家可以选择跟注、加
注、过牌、弃牌、All in。
+ 第三轮，翻出第4张公共牌，由小盲注开始（如果小盲注已弃牌，由后面最近的玩家开始，以此类推），剩余玩家按照顺时针方向依次表态，玩家可以选择跟注、
加注、过牌、弃牌、All in。
+ 第四轮，翻出第5张公共牌，由小盲注开始（如果小盲注已弃牌，由后面最近的玩家开始，以此类推），剩余玩家按照顺时针方向依次表态，玩家可以选择跟注、
加注、过牌、弃牌、All in。

## 游戏结算
经过前面四轮，剩余的玩家开始亮牌比大小，玩家用自己的2张底牌和5张公共牌结合在一起，选出5张牌，凑成最大的成牌，成牌最大的玩家为最终赢家，赢得相应
数量的筹码。

## 比牌方法（暂时不考虑，mock出赢家即可）

## 规则介绍（Concept）
+ 玩家在四轮中分别拿筹码下注，下注金额将进入底池。
```
Given
    游戏玩家：A
    玩家 A 当前筹码数：100
    玩家 A 当前下注金额：0
    游戏底池金额：0
When
    玩家 A 下注 10
Then
    玩家 A 当前筹码数：90
    玩家 A 当前下注金额：10
    游戏底池金额：10
``` 

+ 每一轮游戏都会顺时针遍历游戏中的玩家，依次表态。
```
Given
    游戏玩家: A,B,C,D
    游戏当前操作玩家：A
    游戏等待操作玩家：B,C,D
When
    玩家 A 跟注
Then
    游戏当前操作玩家：B
    游戏等待操作玩家：C,D

-------------------------------------------

Given
    游戏玩家: A,B,C,D
    游戏当前操作玩家：B
    游戏等待操作玩家：C,D
When
    玩家 B 跟注
Then
    游戏当前操作玩家：C
    游戏等待操作玩家：D

-------------------------------------------

Given
    游戏玩家: A,B,C,D
    游戏当前操作玩家：C
    游戏等待操作玩家：D
When
    玩家 C 跟注
Then
    游戏当前操作玩家：D
    游戏等待操作玩家：无
```

+ 玩家在任意轮次中加注，其他游戏中的玩家需要顺时针依次重新表态。
```
Given
    游戏玩家: A,B,C,D
    游戏当前操作玩家：D
    游戏等待操作玩家：无
When
    玩家 D 加注
Then
    游戏当前操作玩家：A
    游戏等待操作玩家：B,C
```

+ 当所有玩家操作（表态）完成，游戏进入到下一轮。
```
Given
    游戏玩家: A,B,C,D
    游戏当前轮次：第一轮
    游戏当前操作玩家：D
    游戏等待操作玩家：无
When
    玩家 D 跟注 
Then
    游戏当前轮次：第二轮

-------------------------------------------

Given
    游戏玩家: A,B,C,D
    游戏当前轮次：第一轮
    游戏当前操作玩家：D
    游戏等待操作玩家：无
When
    玩家 D All in 
Then
    游戏当前轮次：第二轮

-------------------------------------------

Given
    游戏玩家: A,B,C,D
    游戏当前轮次：第一轮
    游戏当前操作玩家：D
    游戏等待操作玩家：无
When
    玩家 D 弃牌
Then
    游戏当前轮次：第二轮

-------------------------------------------

Given
    游戏玩家: A,B,C,D
    游戏当前轮次：第一轮
    游戏当前操作玩家：D
    游戏等待操作玩家：无
When
    玩家 D 过牌
Then
    游戏当前轮次：第二轮

-------------------------------------------

Given
    游戏玩家: A,B,C,D
    游戏当前轮次：第一轮
    游戏当前操作玩家：D
    游戏等待操作玩家：无
When
    玩家 D 加注 
Then
    游戏当前轮次：第一轮
```

+ 当玩家的当前投注金额为游戏最高投注金额时，玩家可以过牌。
```
Given
    游戏玩家: A,B,C,D
    玩家 A 当前投注金额：20
    游戏最高投注金额：20
When
    轮到玩家 A 表态
Then
    当前可进行的操作：包括过牌
```

+ 仅当玩家的筹码不足以跟注时，玩家可以选择All in。
```
Given
    游戏玩家: A,B,C,D
    玩家 A 当前筹码数：10
    玩家 A 当前投注金额：10
    游戏最高投注金额：30
When
    轮到玩家 A 表态
Then
    当前可进行的操作：包括All in

-------------------------------------------

Given
    游戏玩家: A,B,C,D
    玩家 A 当前投注金额：10
    玩家 A 当前筹码数：20
    游戏最高投注金额：30
When
    轮到玩家 A 表态
Then
    当前可进行的操作：不包括All in

-------------------------------------------

Given
    游戏玩家: A,B,C,D
    玩家 A 当前投注金额：10
    玩家 A 当前筹码数：30
    游戏最高投注金额：30
When
    轮到玩家 A 表态
Then
    当前可进行的操作：不包括All in
```

+ All in的玩家可以继续参与游戏，但在后面的游戏中只能过牌。
```
Given
    游戏玩家: A,B,C,D
    游戏All in玩家：无
    游戏中的玩家：A，B,C,D
When
    玩家 A All in
Then
    游戏All in玩家：A
    游戏中的玩家：A，B,C,D

-------------------------------------------

Given
    游戏玩家: A,B,C,D
    游戏All in玩家：A
When
    轮到玩家 A 表态
Then
    当前可进行的操作：只有过牌
```

+ 玩家在任意轮次弃牌则退出游戏。
```
Given
    游戏玩家: A,B,C,D
    游戏中的玩家：A，B,C,D
When
    玩家 A 弃牌
Then
    游戏中的玩家：B,C,D
```

+ 在游戏结算前，如果只剩一位玩家，则直接进入游戏结算。
```
Given
    游戏当前轮次：第一轮/第二轮/第三轮/第四轮
    游戏中的玩家：C,D
When
    玩家 C 弃牌
Then
    游戏当前轮次：游戏结算
    游戏中的玩家：D
```

+ 直到最后一轮投注结束，仍未退出的玩家进入游戏结算阶段。
```
Given
    游戏玩家: A,B,C,D
    游戏当前轮次：第四轮
    游戏当前操作玩家：A
    游戏等待操作玩家：无
    游戏中的玩家：A,B,C,D
When
    玩家 A 跟注
Then
    游戏当前轮次：游戏结算
    游戏中的玩家：A,B,C,D

-------------------------------------------

Given
    游戏玩家: A,B,C,D
    游戏当前轮次：第四轮
    游戏当前操作玩家：A
    游戏等待操作玩家：无
    游戏中的玩家：A,B,C,D
When
    玩家 A 弃牌
Then
    游戏当前轮次：游戏结算
    游戏中的玩家：B,C,D

-------------------------------------------

Given
    游戏玩家: A,B,C,D
    游戏当前轮次：第四轮
    游戏当前操作玩家：A
    游戏等待操作玩家：无
    游戏中的玩家：A,B,C,D
When
    玩家 A 过牌
Then
    游戏当前轮次：游戏结算
    游戏中的玩家：A,B,C,D

-------------------------------------------

Given
    游戏玩家: A,B,C,D
    游戏当前轮次：第四轮
    游戏当前操作玩家：A
    游戏等待操作玩家：无
    游戏中的玩家：A,B,C,D
When
    玩家 A All in
Then
    游戏当前轮次：游戏结算
    游戏中的玩家：A,B,C,D

-------------------------------------------

Given
    游戏玩家: A,B,C,D
    游戏当前轮次：第四轮
    游戏当前操作玩家：A
    游戏等待操作玩家：无
    游戏中的玩家：A,B,C,D
When
    玩家 A 加注
Then
    游戏当前轮次：第四轮
    游戏中的玩家：A,B,C,D
```

+ 游戏结算阶段，如果只剩一位玩家，则该玩家成为赢家，赢得所有底池。
```
Given
    游戏中的玩家：A
    玩家 A 当前筹码数：80
    底池金额：40
    赢家：无
When
    进入游戏结算阶段
Then
    赢家：A
    玩家 A 当前筹码数：120
```

+ 游戏结算阶段，如果剩余多位玩家，则剩余玩家从手牌与河牌挑选最大的组合，进行比较。

+ 如有一人胜出，则该玩家成为赢家，获得底池内所有奖金。
```
Given
    游戏中的玩家：A,B,C,D
    玩家 B 当前筹码数：80
    底池金额：80
When
    玩家 B 成为赢家
Then
    玩家 B 当前筹码数：80 + 80 = 160
```

+ 如有平局，则赢家平分底池内所有奖金。
```
Given
    游戏中的玩家：A,B,C,D
    玩家 A 当前筹码数：130
    玩家 B 当前筹码数：80
    底池金额：80
When
    玩家 A,B 成为赢家
Then
    玩家 A 所持筹码数：130 + (80 / 2) = 170
    玩家 B 所持筹码数：80 + (80 / 2) = 120
```

## 以上的游戏结算没有考虑AllIn的情况，接下是有All in是怎么进行游戏结算
+ 游戏结算时，如果剩余玩家的投注金额相同，则没有All in情况。
A：20 没有All in
B：20 没有All in
C：20 没有All in
D：20 没有All in


+ 游戏结算时，如果剩余玩家的投注金额不同，则存在All in情况。
A：20 没有All in
B：20 没有All in
C：10 All in
D：15 All in 


子池金额平均数为0
剩余玩家A，B，C，D，投注金额分别减去子池金额平均数
如果剩余玩家有All in，则将剩余玩家的投注金额从小到大排序：10(C) > 15(D) > 20(A) > 20(B)，得到子池：10 10 10 10，子池金额平均数为10
如果剩余玩家没有All in，则得到子池：投注金额 * 剩余玩家数

子池金额平均数为10
剩余玩家A，B，D，投注金额分别减去子池金额平均数
如果剩余玩家有All in，则将剩余玩家的投注金额从小到达排序：5(D) > 10(A) > 10(B)，得到子池：5 5 5，子池金额平均数为5
如果剩余玩家没有All in，则得到子池：投注金额 * 剩余玩家数

子池金额平均数为5
剩余玩家A，B，投注金额分别减去子池金额平均数
如果剩余玩家有All in，则将剩余玩家的投注金额从小到达排序：5(A) > 5(B)，得到子池：...
如果剩余玩家没有All in，则得到子池：5 5



## State
### System state
+ 游戏当前轮次：第一轮/第二轮/第三轮/第四轮/游戏结算
+ 游戏当前操作玩家：A
+ 游戏等待操作玩家：B,C,D
+ 游戏中剩余玩家：A,B,C,D
+ 游戏All in玩家：无
+ 游戏最高投注金额：0
+ 游戏底池金额：0
+ 赢家：无
+ 游戏当前可进行的操作：跟注/加注/弃牌/过牌/ALL IN

### User state
+ 玩家筹码总数：100
+ 玩家当前筹码数：90
+ 玩家当前投注金额：10




